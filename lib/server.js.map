{"version":3,"file":"server.js","sources":["../node_modules/@webtides/element-js/src/util/AttributeParser.js","../node_modules/@webtides/element-js/src/util/DOMHelper.js","../node_modules/@webtides/element-js/src/BaseElement.js","../node_modules/@webtides/element-js/src/StyledElement.js","../packages/client/elements/moon-element.js","../packages/client/elements/moon-down-element.js","../packages/client/layouts/base.js","../packages/framework/hooks/definitions.js","../packages/client/functions/network.js","../index.js"],"sourcesContent":["export function isObjectLike(value) {\n\treturn typeof value == 'object' && value !== null;\n}\n\nexport function isJSON(str) {\n\ttry {\n\t\treturn JSON.parse(str) && !!str;\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n\nexport function isBoolean(value) {\n\treturn value === 'true' || value === 'false';\n}\n\nexport function parseBoolean(value) {\n\treturn value === 'true';\n}\n\nexport function isString(value) {\n\treturn (\n\t\ttypeof value === 'string' ||\n\t\t(!!value && typeof value === 'object' && Object.prototype.toString.call(value) === '[object String]')\n\t);\n}\n\nexport function isNumber(value) {\n\treturn new RegExp('^-?(0|0\\\\.\\\\d+|[1-9]\\\\d*(\\\\.\\\\d+)?)$').test(value);\n}\n\nexport function isNaN(value) {\n\treturn Number.isNaN(value);\n}\n\nexport function parseAttribute(value) {\n\tif (!isString(value)) {\n\t\treturn value;\n\t}\n\n\tlet parsedValue = value;\n\n\tif (isJSON(value)) parsedValue = JSON.parse(value);\n\telse if (isBoolean(value)) parsedValue = parseBoolean(value);\n\telse if (isNumber(value)) parsedValue = parseFloat(value);\n\n\treturn parsedValue;\n}\n\n/**\n * Replaces dashed-expression (i.e. some-value) to a camel-cased expression (i.e. someValue)\n * @returns string\n */\nexport function dashToCamel(string) {\n\tif (string.indexOf('-') === -1) return string;\n\n\treturn string.replace(/-[a-z]/g, (matches) => matches[1].toUpperCase());\n}\n\n/**\n * Replaces camel-cased expression (i.e. someValue) to a dashed-expression (i.e. some-value)\n * @returns string\n */\nexport function camelToDash(string) {\n\treturn string.replace(/([A-Z])/g, '-$1').toLowerCase();\n}\n","export function getAllParentNodes(domNode) {\n\tlet node = domNode.parentElement;\n\tlet parents = [];\n\twhile (node) {\n\t\tparents.unshift(node); // adds node to the beginning of parents\n\t\tnode = node.parentElement;\n\t}\n\n\treturn parents;\n}\n\n// https://stackoverflow.com/questions/27453617/how-can-i-tell-if-an-element-is-in-a-shadow-dom\nexport function getShadowParentOrBody(element) {\n\tif (element instanceof ShadowRoot) {\n\t\treturn element;\n\t}\n\n\twhile (element.parentNode && (element = element.parentNode)) {\n\t\tif (element instanceof ShadowRoot) {\n\t\t\treturn element;\n\t\t}\n\t}\n\treturn document.body;\n}\n\n// TODO: add function for getClosestParentOfNodeType('custom-element')\n\nexport function getClosestParentCustomElementNode(domNode) {\n\tconst customElementParents = getAllParentNodes(domNode).filter((node) => {\n\t\treturn node.localName && node.localName.indexOf('-') !== -1;\n\t});\n\n\treturn customElementParents.pop();\n}\n\nexport function isOfSameNodeType(nodeA, nodeB) {\n\tif (!nodeA && !nodeA.localName) return false;\n\tif (!nodeB && !nodeB.localName) return false;\n\treturn nodeA.localName === nodeB.localName;\n}\n\nexport const supportsAdoptingStyleSheets = () =>\n\t'adoptedStyleSheets' in Document.prototype && 'replace' in CSSStyleSheet.prototype;\n\n// for IE11 we are using the ShadyDOM Polyfill. With the polyfill we cannot append stylesheets to the shadowRoot\nexport const supportsAppendingStyleSheets = !window.ShadyDOM;\n","import { parseAttribute, isNaN, dashToCamel, camelToDash, isObjectLike } from './util/AttributeParser.js';\nimport { getClosestParentCustomElementNode, isOfSameNodeType } from './util/DOMHelper.js';\nexport { defineElement } from './util/defineElement';\nexport { toString } from './util/toString';\n\nclass BaseElement extends HTMLElement {\n\tconstructor(options = {}) {\n\t\tsuper();\n\t\tthis.$refs = {};\n\t\tthis._state = {};\n\t\tthis._mutationObserver = null;\n\t\tthis._registeredEvents = [];\n\t\tthis._batchUpdate = null;\n\t\tthis._requestedUpdates = [];\n\t\tthis._options = {\n\t\t\tautoUpdate: true,\n\t\t\tdeferUpdate: true,\n\t\t\tmutationObserverOptions: {\n\t\t\t\tattributes: true,\n\t\t\t\tchildList: true,\n\t\t\t\tsubtree: false,\n\t\t\t\t...options.mutationObserverOptions,\n\t\t\t},\n\t\t\tpropertyOptions: {},\n\t\t\t...options,\n\t\t};\n\n\t\tif (options.childListUpdate !== undefined && options.childListUpdate !== null) {\n\t\t\tthis._options.mutationObserverOptions.childList = options.childListUpdate;\n\t\t\tconsole.warn(\n\t\t\t\t`[${this.localName}] Using the \"childListUpdate\" option is deprecated and will be removed before 1.0! Please use the \"mutationObserverOptions\" dictionary instead. See the docs for more info`,\n\t\t\t);\n\t\t}\n\t}\n\n\tconnectedCallback() {\n\t\t// define all attributes to \"this\" as properties\n\t\tthis.defineAttributesAsProperties();\n\n\t\t// define all properties to \"this\"\n\t\tthis.defineProperties();\n\n\t\t// define all computed properties to \"this\"\n\t\tthis.defineComputedProperties();\n\n\t\t// define everything that should be observed\n\t\tthis.defineObserver();\n\n\t\tif (this.hasAttribute('defer-update') || this._options.deferUpdate) {\n\t\t\t// don't updates/render, but register refs and events\n\t\t\tthis.registerEventsAndRefs();\n\n\t\t\tthis.triggerHook('connected');\n\t\t} else {\n\t\t\tthis.requestUpdate({ notify: false }).then(() => {\n\t\t\t\tthis.triggerHook('connected');\n\t\t\t});\n\t\t}\n\t}\n\n\tdefineObserver() {\n\t\t// see: https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver#Example_usage\n\t\tthis._mutationObserver = new MutationObserver((mutations) => {\n\t\t\tmutations.forEach((mutation) => {\n\t\t\t\tif (\n\t\t\t\t\tmutation.type === 'attributes' &&\n\t\t\t\t\tmutation.target === this &&\n\t\t\t\t\tthis._state.hasOwnProperty(dashToCamel(mutation.attributeName))\n\t\t\t\t) {\n\t\t\t\t\t// update property by invoking the setter\n\t\t\t\t\tthis[dashToCamel(mutation.attributeName)] = parseAttribute(\n\t\t\t\t\t\tthis.getAttribute(mutation.attributeName),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (mutation.type === 'attributes' && mutation.target !== this) {\n\t\t\t\t\tthis.requestUpdate();\n\t\t\t\t}\n\t\t\t\tif (mutation.type === 'childList') {\n\t\t\t\t\tthis.requestUpdate();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis._mutationObserver.observe(this, {\n\t\t\tattributes: true,\n\t\t\tchildList: true,\n\t\t\tsubtree: false,\n\t\t\t...this._options.mutationObserverOptions,\n\t\t});\n\t}\n\n\tdisconnectedCallback() {\n\t\t// remove events for elements in the component\n\t\tthis.removeEvents();\n\n\t\t// remove observers\n\t\tif (this._mutationObserver) this._mutationObserver.disconnect();\n\n\t\tthis.triggerHook('disconnected');\n\t}\n\n\trequestUpdate(options = { notify: true }) {\n\t\tif (options.notify === true) {\n\t\t\tthis.triggerHook('beforeUpdate');\n\t\t}\n\n\t\tif (this._batchUpdate) {\n\t\t\tcancelAnimationFrame(this._batchUpdate);\n\t\t\tthis._batchUpdate = false;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis._requestedUpdates.push({ resolve, reject });\n\t\t\tthis._batchUpdate = requestAnimationFrame(() => {\n\t\t\t\ttry {\n\t\t\t\t\tthis.update(options);\n\t\t\t\t\tthis._requestedUpdates.forEach(({ resolve, reject }) => resolve());\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// console.error('Update error', e)\n\t\t\t\t\tthis._requestedUpdates.forEach(({ resolve, reject }) => reject(e));\n\t\t\t\t}\n\t\t\t\tthis._requestedUpdates = [];\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * This should be called by the template component AFTER adding the template to\n\t * the DOM.\n\t * Here we will register the events and the refs for the element.\n\t */\n\tupdate(options = { notify: true }) {\n\t\tthis.registerEventsAndRefs();\n\t\tif (options.notify === true) {\n\t\t\tthis.triggerHook('afterUpdate');\n\t\t}\n\t}\n\n\t/**\n\t * Register events and refs for the component\n\t */\n\tregisterEventsAndRefs() {\n\t\t// register events for elements in the component\n\t\tthis.registerEvents();\n\n\t\t// register $refs\n\t\tthis.registerRefs();\n\t}\n\n\t/**\n\t * Defines all attributes assigned in the HTML for the element as properties on the element\n\t * If the value for an attribute can be parsed to an object or array, it will do so\n\t */\n\tdefineAttributesAsProperties() {\n\t\tconst ignoreAttributes = ['class', 'style'];\n\t\tArray.from(this.attributes)\n\t\t\t.filter((attribute) => {\n\t\t\t\treturn !ignoreAttributes.includes(attribute.name);\n\t\t\t})\n\t\t\t.forEach((attribute) => {\n\t\t\t\tthis.defineProperty(dashToCamel(attribute.name), parseAttribute(attribute.value), true);\n\t\t\t});\n\t}\n\n\t/**\n\t * Properties to be defined and assigned on the element. Should be overwritten in child components\n\t * Properties defined here will also trigger a update() when changed.\n\t * eg. { stringProperty: 'value', numberProperty: 13, booleanProperty: true } }\n\t * @return {{}}\n\t */\n\tproperties() {\n\t\treturn {};\n\t}\n\n\t/**\n\t * Defines properties on the element based on keys from this.properties()\n\t * Will trigger update() when a property was changed\n\t */\n\tdefineProperties() {\n\t\tObject.keys(this.properties()).forEach((prop) => {\n\t\t\t// when mixing shadow dom elements with light dom elements and nesting custom elements\n\t\t\t// it might occur that properties where set on an element before it was\n\t\t\t// registered or connected. To avoid such timing issues we check\n\t\t\t// if a value was set for that specific property on the\n\t\t\t// prototype before assigning a default value\n\t\t\tconst value = this[prop] || this.properties()[prop];\n\t\t\tthis.defineProperty(prop, value);\n\t\t});\n\t}\n\n\t/**\n\t * Define a property on the element\n\t * Will trigger watch() function when a property was changed\n\t * Will trigger update() when a property was changed\n\t */\n\tdefineProperty(property, value, reflectAttribute = false) {\n\t\tif (this._state.hasOwnProperty(property)) {\n\t\t\t// property has already been defined as an attribute nothing to do here\n\t\t\treturn;\n\t\t}\n\n\t\t// if property did not come from an attribute but has the option to reflect\n\t\tif (!reflectAttribute && this._options.propertyOptions[property]?.reflect === true) {\n\t\t\tthis.reflectProperty({ property: property, newValue: value });\n\t\t}\n\n\t\t// remove attribute if reflect is set to false explicitly in options\n\t\tif (this._options.propertyOptions[property]?.reflect === false) {\n\t\t\tthis.removeAttribute(camelToDash(property));\n\t\t}\n\n\t\tthis._state[property] = value;\n\n\t\tObject.defineProperty(this, property, {\n\t\t\tget: () => {\n\t\t\t\treturn this._state[property];\n\t\t\t},\n\t\t\tset: (newValue) => {\n\t\t\t\tconst oldValue = this._state[property];\n\t\t\t\tconst newValueString = JSON.stringify(newValue);\n\n\t\t\t\tif (JSON.stringify(oldValue) !== newValueString) {\n\t\t\t\t\tthis._state[property] = newValue;\n\n\t\t\t\t\tif (reflectAttribute || this._options.propertyOptions[property]?.reflect === true) {\n\t\t\t\t\t\tthis.reflectProperty({ property, newValue, newValueString });\n\t\t\t\t\t}\n\n\t\t\t\t\tconst informWatchedPropertiesAndDispatchChangeEvent = () => {\n\t\t\t\t\t\t// notify watched properties (after update())\n\t\t\t\t\t\tif (property in this.watch()) {\n\t\t\t\t\t\t\tthis.watch()[property](newValue, oldValue);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// dispatch change event\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tproperty in this._options['propertyOptions'] &&\n\t\t\t\t\t\t\tthis._options['propertyOptions'][property]['notify'] === true\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthis.dispatch(`${camelToDash(property)}-changed`, newValue, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tif (this._options.autoUpdate) {\n\t\t\t\t\t\tthis.requestUpdate({\n\t\t\t\t\t\t\tnotify: true,\n\t\t\t\t\t\t\tproperty: property,\n\t\t\t\t\t\t\tnewValue: newValue,\n\t\t\t\t\t\t\tnewValueString: newValueString,\n\t\t\t\t\t\t\toldValue: oldValue,\n\t\t\t\t\t\t}).finally(() => {\n\t\t\t\t\t\t\tinformWatchedPropertiesAndDispatchChangeEvent();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinformWatchedPropertiesAndDispatchChangeEvent();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t},\n\t\t});\n\t}\n\n\treflectProperty(options) {\n\t\tconst { property, newValue } = options;\n\t\tconst newValueString = options.newValueString || JSON.stringify(newValue);\n\n\t\tif (newValue === undefined || newValue === null || isNaN(newValue)) {\n\t\t\t// these would be reflected as strings: \"undefined\" || \"null\" || \"NaN\"\n\t\t\t// which is not the desired behaviour. Therefore we reflect them as empty strings\n\t\t\tthis.setAttribute(camelToDash(property), '');\n\t\t} else {\n\t\t\tconst attributeValue = isObjectLike(newValue) ? newValueString : newValue;\n\t\t\tthis.setAttribute(camelToDash(property), attributeValue);\n\t\t}\n\t}\n\n\t// Deprecated\n\thooks() {\n\t\treturn {};\n\t}\n\n\t// Connected lifecycle hook\n\tconnected() {}\n\n\t// BeforeUpdate lifecycle hook\n\tbeforeUpdate() {}\n\n\t// AfterUpdate lifecycle hook\n\tafterUpdate() {}\n\n\t// Disconnected lifecycle hook\n\tdisconnected() {}\n\n\t// Triggers a lifecycle hook based on the name\n\ttriggerHook(name) {\n\t\tif (this.hooks && name in this.hooks()) {\n\t\t\tconsole.warn(\n\t\t\t\t`[${this.localName}] Using the hooks() map for lifecycle hooks is deprecated! Please overwrite the existing lifecycle hook functions. See the docs for more info`,\n\t\t\t);\n\t\t\tthis.hooks()[name]();\n\t\t\treturn;\n\t\t}\n\n\t\tif (name in this) {\n\t\t\tthis[name]();\n\t\t}\n\t}\n\n\t/**\n\t * Watched attributes & properties to be notified to the element when changed. Should be overwritten in child components\n\t * When an attribute or property as the key was changed on the element, the callback function defined as value\n\t * will be called with `newValue` and `oldValue`\n\t * eg. { property: (oldValue, newValue) => { console.log('property changed!, oldValue, newValue); } }\n\t * @return {{}}\n\t */\n\twatch() {\n\t\treturn {};\n\t}\n\n\t// Deprecated\n\tcomputed() {\n\t\treturn {};\n\t}\n\n\t// Deprecated\n\tdefineComputedProperties() {\n\t\tObject.keys(this.computed()).forEach((prop) => {\n\t\t\tif (!this.hasOwnProperty(prop)) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`[${this.localName}] Using the computed() map for computed properties is deprecated! Please use regular JS getters and return the computed value. See the docs for more info`,\n\t\t\t\t);\n\t\t\t\tObject.defineProperty(this, prop, {\n\t\t\t\t\tget: () => this.computed()[prop](),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Return a map of events that should be registered on the element.\n\t * eg. { '.link': {\n\t *               'click': (e) => {console.log('MyElement.link - clicked', e)},\n\t *               'mouseover': (e) => {console.log('MyElement.link - mouseover()', e)},\n\t *           }\n\t *     }\n\t */\n\tevents() {\n\t\treturn {};\n\t}\n\n\t/**\n\t * Registers events on the element based on events().\n\t * Removes all previously registered events before adding them.\n\t */\n\tregisterEvents() {\n\t\t// remove all previously registered events to prevent duplicate triggers\n\t\tthis.removeEvents();\n\n\t\t// register events\n\t\tconst eventDefinitions = this.events();\n\t\tObject.keys(eventDefinitions).forEach((elementSelector) => {\n\t\t\tconst events = eventDefinitions[elementSelector];\n\t\t\tconst selectorWhiteList = { window, document, this: this.getRoot() };\n\t\t\tconst whiteListElement = selectorWhiteList[elementSelector];\n\t\t\tconst eventTargets = whiteListElement\n\t\t\t\t? [whiteListElement]\n\t\t\t\t: this.getRoot().querySelectorAll(elementSelector);\n\n\t\t\teventTargets.forEach((eventTarget) => {\n\t\t\t\tObject.keys(events).forEach((eventName) => {\n\t\t\t\t\tconst callback = events[eventName].bind(this);\n\t\t\t\t\teventTarget.addEventListener(eventName, callback);\n\t\t\t\t\tthis._registeredEvents.push({ eventTarget, eventName, callback });\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Removes all events from the element that where previously registered from the events() map.\n\t */\n\tremoveEvents() {\n\t\tthis._registeredEvents.forEach(({ eventTarget, eventName, callback }) => {\n\t\t\tif (eventTarget === window || eventTarget === document || this.getRoot().contains(eventTarget)) {\n\t\t\t\teventTarget.removeEventListener(eventName, callback);\n\t\t\t}\n\t\t});\n\t\tthis._registeredEvents = [];\n\t}\n\n\t/**\n\t * Stores an object that references child elements & DOM nodes that have a ref attribute defined.\n\t * References will be accessible on the element under this.$refs\n\t */\n\tregisterRefs() {\n\t\tconst refsNodeList = this.getRoot().querySelectorAll('[ref]');\n\t\tconst refsArray = Array.from(refsNodeList);\n\t\tconst refsMap = {};\n\n\t\trefsArray.forEach((refNode) => {\n\t\t\tconst refKey = refNode.getAttribute('ref');\n\t\t\trefsMap[refKey] = refNode;\n\t\t});\n\n\t\tthis.$refs = refsMap;\n\t}\n\n\t// Helper function for dispatching custom events\n\tdispatch(name, data, bubble = false, cancelable = false, composed = false) {\n\t\tconst event = new CustomEvent(name, {\n\t\t\tbubbles: bubble,\n\t\t\tcancelable: cancelable,\n\t\t\tcomposed: composed,\n\t\t\tdetail: data,\n\t\t});\n\t\tthis.dispatchEvent(event);\n\t}\n\n\t// Get the root element\n\tgetRoot() {\n\t\treturn this;\n\t}\n}\n\nexport { BaseElement, getClosestParentCustomElementNode, isOfSameNodeType };\n","import { BaseElement } from './BaseElement';\nimport { supportsAdoptingStyleSheets, getShadowParentOrBody } from './util/DOMHelper';\nexport { i18n } from './util/i18n';\n\nclass StyledElement extends BaseElement {\n\tstatic globalStyles = null;\n\n\tstatic updateGlobalStyles() {\n\t\t// this is a runtime dependency so that every shadow dom can make use of global css\n\t\t// we assume these styles to be inlined into the document\n\t\tStyledElement.globalStyles = document.getElementById('globalStyles');\n\n\t\tif (StyledElement.globalStyles && StyledElement['globalStyleSheet']) {\n\t\t\t//updates already adopted global styles\n\t\t\tStyledElement['globalStyleSheet'].replaceSync(StyledElement.globalStyles.textContent);\n\t\t}\n\t}\n\n\tconstructor(options) {\n\t\tsuper({\n\t\t\tdeferUpdate: false,\n\t\t\tshadowRender: false,\n\t\t\tstyles: [],\n\t\t\tadoptGlobalStyles: true,\n\t\t\t...options,\n\t\t});\n\t\tthis._styles = [...this._options.styles, ...this.styles()];\n\t}\n\n\tconnectedCallback() {\n\t\tsuper.connectedCallback();\n\n\t\tif (supportsAdoptingStyleSheets() && this._options.shadowRender) {\n\t\t\t// adopting does only make sense in shadow dom. Fall back to append for light elements\n\t\t\tthis.adoptStyleSheets();\n\t\t} else if (this._options.shadowRender && window.ShadyCSS !== undefined) {\n\t\t\t// if shadowRoot is polyfilled we use ShadyCSS to copy scoped styles to <head>\n\t\t\twindow.ShadyCSS.ScopingShim.prepareAdoptedCssText(this._styles, this.localName);\n\t\t}\n\n\t\t// if shadowRoot is polyfilled - scope element template\n\t\tif (window.ShadyCSS !== undefined) {\n\t\t\twindow.ShadyCSS.styleElement(this);\n\t\t}\n\t}\n\n\tstyles() {\n\t\treturn [];\n\t}\n\n\tupdate(options) {\n\t\tif (!supportsAdoptingStyleSheets() || this._options.shadowRender === false) {\n\t\t\t// append stylesheets to template if not already adopted\n\t\t\tconst appendableStyles = [...this._styles];\n\t\t\tif (this._options.shadowRender && this._options.adoptGlobalStyles && !window.ShadyCSS) {\n\t\t\t\tappendableStyles.unshift(StyledElement.globalStyles?.textContent ?? '');\n\t\t\t}\n\t\t\tthis.appendStyleSheets(appendableStyles);\n\t\t}\n\t\tsuper.update(options);\n\t}\n\n\tadoptStyleSheets() {\n\t\tif (!this.constructor['cssStyleSheets']) {\n\t\t\tthis.constructor['cssStyleSheets'] = this._styles.map((style) => {\n\t\t\t\tconst sheet = new CSSStyleSheet();\n\t\t\t\tif (sheet && sheet.cssRules.length === 0) {\n\t\t\t\t\tsheet.replaceSync(style);\n\t\t\t\t}\n\t\t\t\treturn sheet;\n\t\t\t});\n\t\t}\n\n\t\tif (StyledElement.globalStyles && !StyledElement['globalStyleSheet']) {\n\t\t\tStyledElement['globalStyleSheet'] = new CSSStyleSheet();\n\t\t\tStyledElement['globalStyleSheet'].replaceSync(StyledElement.globalStyles.textContent);\n\t\t}\n\n\t\t// adopt styles\n\t\t// uses proposed solution for constructable stylesheets\n\t\t// see: https://wicg.github.io/construct-stylesheets/#proposed-solution\n\t\tthis.getRoot().adoptedStyleSheets = [\n\t\t\t...(this._options.shadowRender && this._options.adoptGlobalStyles && StyledElement['globalStyleSheet']\n\t\t\t\t? [StyledElement['globalStyleSheet']]\n\t\t\t\t: []),\n\t\t\t...this.constructor['cssStyleSheets'],\n\t\t];\n\t}\n\n\t// custom polyfill for constructable stylesheets by appending styles to the end of an element\n\tappendStyleSheets(styles) {\n\t\tconst parentDocument = getShadowParentOrBody(this.getRoot());\n\t\tstyles.forEach((style, index) => {\n\t\t\tconst identifier = this.tagName + index;\n\n\t\t\t// only append stylesheet if not already appended to shadowRoot or document\n\t\t\tif (!parentDocument.querySelector(`#${identifier}`)) {\n\t\t\t\tconst styleElement = document.createElement('style');\n\t\t\t\tstyleElement.id = identifier;\n\t\t\t\tstyleElement.style.display = 'none';\n\t\t\t\tstyleElement.textContent = style;\n\t\t\t\tparentDocument.appendChild(styleElement);\n\t\t\t}\n\t\t});\n\t}\n}\n\nStyledElement.updateGlobalStyles();\n\nexport { StyledElement };\n","import {StyledElement} from '@webtides/element-js/src/StyledElement';\n\nimport { render, html } from \"lit-html\";\nimport { unsafeHTML } from \"lit-html/directives/unsafe-html\";\n\nexport {html, unsafeHTML};\n\nconst isOnServer = () => {\n    return (typeof global !== \"undefined\" && global.SSR);\n}\n\nexport default class MoonElement extends StyledElement {\n\n    constructor(options) {\n        super({\n            deferUpdate: false,\n            shadowRender: false,\n            styles: [],\n            adoptGlobalStyles: true,\n            mutationObserverOptions: {\n                childList: false,\n            },\n            ...options,\n        });\n        this._template = this._options.template;\n\n        if (!isOnServer() && this._options.shadowRender) {\n            this.attachShadow({mode: 'open'});\n        }\n    }\n\n    // 1. we need to skip initial render when we already have rendered server side\n    connectedCallback() {\n        // define all attributes to \"this\" as properties\n        this.defineAttributesAsProperties();\n\n        // define all properties to \"this\"\n        this.defineProperties();\n\n        // define all computed properties to \"this\"\n        this.defineComputedProperties();\n\n        // define everything that should be observed\n        this.defineObserver();\n\n        if (this.hasAttribute('ssr')) {\n\n            this.registerEventsAndRefs();\n\n            if (!isOnServer() && !this._options.shadowRender) {\n                this.triggerHook('connected');\n            }\n\n            if (!isOnServer() && this._options.shadowRender) {\n                this.requestUpdate({notify: false}).then(() => {\n                    this.triggerHook('connected');\n                });\n            }\n\n            this.setAttribute('hydrate', 'true');\n\n        } else if (this.hasAttribute('defer-update') || this._options.deferUpdate) {\n            // don't updates/render, but register refs and events\n            this.registerEventsAndRefs();\n\n            this.triggerHook('connected');\n        } else {\n            this.requestUpdate({notify: false}).then(() => {\n                this.triggerHook('connected');\n            });\n        }\n    }\n\n    // 2. we need to be able to inject properties from outside that will contain the attributes as well\n    defineProperties(properties = this.properties()) {\n        Object.keys(properties).forEach((prop) => {\n            // when mixing shadow dom elements with light dom elements and nesting custom elements\n            // it might occur that properties where set on an element before it was\n            // registered or connected. To avoid such timing issues we check\n            // if a value was set for that specific property on the\n            // prototype before assigning a default value\n            const value = this[prop] || properties[prop];\n            this.defineProperty(prop, value);\n        });\n    }\n\n    defineProperty(property, value, reflectAttribute = false) {\n        if (!isOnServer()) {\n            return super.defineProperty(property, value, reflectAttribute);\n        } else {\n            this[property] = value;\n        }\n    }\n\n    update(options) {\n        this.renderTemplate();\n\n        if (!isOnServer()) {\n            this.appendStyleSheets(this._styles);\n\n            super.update(options);\n        }\n    }\n\n    // 3. we need to inject a different context for the template method to be able to switch from lit-html to something that runs in node\n    renderTemplate() {\n        const template = this._template || this.template();\n\n        if (typeof template === 'string') {\n            // just a plain string literal. no lit-html required\n            this.getRoot().innerHTML = `${template}`;\n        } else {\n            // render via lit-html\n            render(template, this.getRoot(), {\n                scopeName: this.localName,\n                eventContext: this,\n            });\n        }\n    }\n\n    template() {\n        return '';\n    }\n\n    getRoot() {\n        return this.shadowRoot !== null ? this.shadowRoot : this;\n    }\n\n    dependencies() { return []; }\n\n    /**\n     * This will be loaded each time the custom element is found on the page.\n     * Make sure to really only load data which is unique for every element on the page.\n     *\n     * Here we can make calls to the database or any other service with data we require on each page load.\n     *\n     * If we are statically exporting the site, these properties won't ever be loaded.\n     *\n     * @param {*}\n     *\n     * @returns {Promise<{}>}   An object which holds the dynamically loaded data.\n     *                          Make sure that each key returned by this method is also present\n     *                          inside your {@link properties() } method. If a key is not\n     *                          present, it won't be passed to the client.\n     */\n    async loadDynamicProperties({ request, response }) {\n        return false;\n    }\n\n\n    /**\n     * These properties will be loaded once as the server starts up, or if\n     * we want to statically export our site.\n     *\n     * @returns {Promise<{}>}   An object which holds the statically loaded data.\n     *                          Make sure that each key returned by this method is also present\n     *                          inside your {@link properties() } method. If a key is not\n     *                          present, it won't be passed to the client.\n     */\n    static async loadStaticProperties() {\n        return false;\n    }\n\n    static get disableSSR() { return false; }\n\n    static get dynamicPropertiesCacheable() { return false; }\n}\n\nexport { isOnServer };\n","import MoonElement from \"./moon-element\";\n\nexport default class MoonDownElement extends MoonElement {\n\n    async loadDynamicProperties({ request, response }) {\n        if (!this.source) {\n            return {};\n        }\n\n        const fs = (await import(\"fs\")).default;\n\n        if (!fs.existsSync(this.source)) {\n            console.log(`File ${this.source} does not exist.`)\n            return {};\n        }\n\n        const frontmatter = require(\"@github-docs/frontmatter\");\n        const marked = require(\"marked\");\n\n        const result = frontmatter(fs.readFileSync(this.source, { encoding: \"utf-8\" }));\n\n        return {\n            text: marked(result.content),\n            ...result.data\n        }\n    }\n\n    static get dynamicPropertiesCacheable() {\n        return true;\n    }\n}\n","const scripts = ({ html }) => {\n    return html`\n        <script src=\"/libraries/webcomponents-bundle.js\" nomodule></script>\n        <script src=\"/libraries/runtime.js\" nomodule></script>\n        <script src=\"/assets/bundle.legacy.js\" nomodule></script>\n    `;\n}\n\nconst template = ({ html, context }) => {\n    return html`\n        <!doctype html>\n        <html lang=\"\">\n            <head>\n                <title>${context.title ?? \"\"}</title>\n                ${context.head ?? \"\"}\n            </head>\n            <body>\n                ${context.page ?? \"\"}\n\n                ${context.footer ?? \"\"}\n                \n                ${scripts({ html })}\n            </body>\n        </html>\n    `;\n};\n\nexport {\n    scripts\n}\n\nexport default template;\n","const HOOKS = {\r\n    HOOKS_LOADED: \"hooks-loaded\",\r\n\r\n    COMPONENTS_LOADED: \"components-loaded\",\r\n\r\n    SERVER_STARTED: \"server-started\",\r\n\r\n    ROUTES_BEFORE_REGISTER: \"routes-before-register\",\r\n    ROUTES_AFTER_REGISTER: \"routes-after-register\",\r\n\r\n    REQUEST_RECEIVED: \"request-received\",\r\n\r\n    MIDDLEWARE_REGISTER: \"middleware-register\",\r\n\r\n    CSS_LOAD: \"css-load\"\r\n};\r\n\r\nexport { HOOKS };\r\n","const getBaseRequestHeaders = () => {\n    return {\n        'Content-Type': 'application/json'\n    }\n}\n\nconst parseBody = body => {\n    if (!body) {\n        return undefined;\n    }\n\n    let json = body;\n\n    if (body instanceof FormData) {\n        json = { };\n        body.forEach((value, key) => json[key] = value);\n    }\n\n    return JSON.stringify(json);\n};\n\n\nconst apiRequest = async (api, { method = \"GET\", headers = [], body }) => {\n    const parts = api.split(\"/\").filter(part => part.length > 0);\n\n    try {\n        const response = await fetch([ \"api\", ...parts ].join(\"/\"), {\n            method,\n            body: parseBody(body),\n            headers: {\n                ...getBaseRequestHeaders(),\n                ...headers\n            }\n        });\n\n        const success = response.ok;\n\n        let data;\n        switch (response.headers.get(\"Content-Type\")) {\n            case \"application/json\":\n                data = await response.json();\n                return;\n            default:\n                data = await response.text();\n        }\n\n        return {\n            success,\n            status: response.status,\n            response,\n            data\n        };\n\n    } catch (error) {\n        return { success: false, status: 500, error };\n    }\n};\n\n\nexport {\n    apiRequest\n}\n","import MoonElement, { html, unsafeHTML } from \"./packages/client/elements/moon-element.js\";\nimport MoonDownElement from \"./packages/client/elements/moon-down-element\";\nimport baseLayout from \"./packages/client/layouts/base.js\";\nimport { HOOKS } from \"./packages/framework/hooks/definitions\";\nimport { apiRequest } from \"./packages/client/functions/network\";\nimport {BaseElement} from \"@webtides/element-js/src/BaseElement\";\n\nconst layouts = {\n    base: baseLayout\n}\n\nexport {\n    MoonElement,\n    MoonDownElement,\n    BaseElement,\n    layouts,\n    HOOKS,\n    apiRequest,\n    html,\n    unsafeHTML\n}\n"],"names":["isObjectLike","value","isJSON","str","JSON","parse","e","isBoolean","parseBoolean","isString","Object","prototype","toString","call","isNumber","RegExp","test","isNaN","Number","parseAttribute","parsedValue","parseFloat","dashToCamel","string","indexOf","replace","matches","toUpperCase","camelToDash","toLowerCase","getShadowParentOrBody","element","ShadowRoot","parentNode","document","body","supportsAdoptingStyleSheets","Document","CSSStyleSheet","BaseElement","HTMLElement","constructor","options","$refs","_state","_mutationObserver","_registeredEvents","_batchUpdate","_requestedUpdates","_options","autoUpdate","deferUpdate","mutationObserverOptions","attributes","childList","subtree","propertyOptions","childListUpdate","undefined","console","warn","localName","connectedCallback","defineAttributesAsProperties","defineProperties","defineComputedProperties","defineObserver","hasAttribute","registerEventsAndRefs","triggerHook","requestUpdate","notify","then","MutationObserver","mutations","forEach","mutation","type","target","hasOwnProperty","attributeName","getAttribute","observe","disconnectedCallback","removeEvents","disconnect","cancelAnimationFrame","Promise","resolve","reject","push","requestAnimationFrame","update","registerEvents","registerRefs","ignoreAttributes","Array","from","filter","attribute","includes","name","defineProperty","properties","keys","prop","property","reflectAttribute","reflect","reflectProperty","newValue","removeAttribute","get","set","oldValue","newValueString","stringify","informWatchedPropertiesAndDispatchChangeEvent","watch","dispatch","finally","setAttribute","attributeValue","hooks","connected","beforeUpdate","afterUpdate","disconnected","computed","events","eventDefinitions","elementSelector","selectorWhiteList","window","this","getRoot","whiteListElement","eventTargets","querySelectorAll","eventTarget","eventName","callback","bind","addEventListener","contains","removeEventListener","refsNodeList","refsArray","refsMap","refNode","refKey","data","bubble","cancelable","composed","event","CustomEvent","bubbles","detail","dispatchEvent","StyledElement","updateGlobalStyles","globalStyles","getElementById","replaceSync","textContent","shadowRender","styles","adoptGlobalStyles","_styles","adoptStyleSheets","ShadyCSS","ScopingShim","prepareAdoptedCssText","styleElement","appendableStyles","unshift","appendStyleSheets","map","style","sheet","cssRules","length","adoptedStyleSheets","parentDocument","index","identifier","tagName","querySelector","createElement","id","display","appendChild","serverLitHtml","MoonDownElement","MoonElement","loadDynamicProperties","request","response","source","fs","default","existsSync","log","frontmatter","require","marked","result","readFileSync","encoding","text","content","dynamicPropertiesCacheable","scripts","html","template","context","title","head","page","footer","HOOKS","HOOKS_LOADED","COMPONENTS_LOADED","SERVER_STARTED","ROUTES_BEFORE_REGISTER","ROUTES_AFTER_REGISTER","REQUEST_RECEIVED","MIDDLEWARE_REGISTER","CSS_LOAD","getBaseRequestHeaders","parseBody","json","FormData","key","apiRequest","api","method","headers","parts","split","part","fetch","join","success","ok","status","error","layouts","base","baseLayout"],"mappings":"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"}